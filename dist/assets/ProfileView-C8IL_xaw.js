import{Q as K,k as P,T as q,y as L,d as F,u as H,l as z,z as V,e as I,c as a,a as e,t as h,h as x,j as y,I as S,n as O,p as b,q as A,v as T,D as Y,B as Q,w as W,g as G,o as i,_ as J,C as R,L as X,F as Z,A as D,i as ee}from"./index-WKext-pH.js";import{u as te}from"./listings-D5iJdAXG.js";import{L as se}from"./Text.vue_vue_type_script_setup_true_lang-CyQVRKCi.js";import{L as oe}from"./LocationSelector-CIHh1hpR.js";import{r as re}from"./CheckCircleIcon-BcCDUHwz.js";import{L as ne}from"./ListingMini-C8Ot9Es3.js";import"./Map-Cr7WoUv5.js";import"./constants-DDm60LNs.js";import"./ListingPills-BMTqgBnq.js";const ie=K("reputation",()=>{const _=P({}),r=P(!1),g=s=>{const o=_.value[s];if(!o)return{status:"unknown",positive:0,negative:0,total:0,positivePercentage:0,negativePercentage:0,unknownPercentage:100};const l=o.positive_points+o.negative_points;if(l<100)return{status:"unknown",positive:o.positive_points,negative:o.negative_points,total:l,positivePercentage:0,negativePercentage:0,unknownPercentage:100};const d=o.positive_points/l*100,u=o.negative_points/l*100;return{status:"known",positive:o.positive_points,negative:o.negative_points,total:l,positivePercentage:d,negativePercentage:u,unknownPercentage:0}},c=async s=>{if(!_.value[s]){r.value=!0;try{const{data:o,error:l}=await L.from("reputation").select("*").eq("user_id",s).maybeSingle();if(l)throw l;if(o)_.value[s]=o;else{const{data:p,error:d}=await L.from("reputation").insert([{user_id:s,positive_points:0,negative_points:0,total_interactions:0}]).select().single();if(d)throw d;_.value[s]=p}}catch(o){console.error("Error fetching reputation:",o)}finally{r.value=!1}}},w=async s=>{r.value=!0;try{const{data:o,error:l}=await L.from("reviews").insert([s]).select().single();if(l)throw l;let p=0,d=0;s.punctuality==="on-time"?p+=5:s.punctuality==="late"?d+=3:s.punctuality==="no-show"&&(d+=10),s.helpfulness==="helpful"?p+=5:s.helpfulness==="unhelpful"&&(d+=3),s.accuracy==="as-described"?p+=5:s.accuracy==="not-as-described"&&(d+=5);const{error:u}=await L.rpc("update_reputation",{user_id:s.reviewee_id,positive_delta:p,negative_delta:d});if(u)throw u;return delete _.value[s.reviewee_id],await c(s.reviewee_id),{data:o,error:null}}catch(o){return{data:null,error:o.message}}finally{r.value=!1}};return{reputations:q(_),loading:q(r),getReputationDisplay:g,fetchReputation:c,submitReview:w}}),ae={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-8"},le={class:"mb-8"},ue={class:"text-2xl font-bold text-gray-900 mb-2"},ce={class:"text-gray-600"},de={key:0,class:"flex justify-center py-8"},pe={class:"space-y-6"},fe={class:"grid md:grid-cols-2 gap-6"},me={key:0,class:"mt-1 text-sm text-error-600"},ge=["value"],ve={key:0,class:"mt-1 text-sm text-error-600"},ye={class:"space-y-6"},_e={key:0,class:"rounded-md bg-error-50 p-4"},he={class:"flex"},xe={class:"text-sm text-error-700"},be={key:1,class:"rounded-md bg-success-50 p-4"},we={class:"flex"},Pe={class:"text-sm text-success-700"},ke={class:"flex justify-end pt-6 border-t border-gray-200"},$e=F({__name:"UserProfileForm",props:{existingProfile:{default:null},compact:{type:Boolean,default:!1}},emits:["success","error"],setup(_,{expose:r,emit:g}){const c=_,w=g,s=H(),o=P(!1),l=P(!1),p=P(""),d=P(!1),u=P("idle"),f=P(""),m=z({full_name:"",phone:""}),n=z({full_name:"",phone:"",location:null}),k=V(()=>!c.existingProfile),E=V(()=>!!(n.full_name.trim()&&!m.full_name&&!m.phone)),N=()=>{m.full_name="",n.full_name.trim()?n.full_name.trim().length<2&&(m.full_name="Full name must be at least 2 characters"):m.full_name="Full name is required"},U=()=>{m.phone="",n.phone&&n.phone.trim()&&(/^[\+]?[1-9][\d]{0,15}$/.test(n.phone.replace(/[\s\-\(\)]/g,""))||(m.phone="Please enter a valid phone number"))},C=async()=>{u.value="loading",f.value="";try{const v=await se.getCurrentPosition();n.location={lat:v.latitude,lng:v.longitude},u.value="success"}catch(v){u.value="error",f.value=v.message||"Unable to get your location. Please ensure location services are enabled.",console.error("Location error:",v)}},B=async()=>{if(N(),U(),!!E.value){if(!s.session){p.value="Not authenticated";return}l.value=!0,p.value="",d.value=!1;try{const v={full_name:n.full_name.trim(),phone:n.phone.trim()||void 0,location:n.location||void 0};let t;k.value?t=await s.updateProfile(v):t=await s.updateProfile(v),t.error?(p.value=t.error,w("error",t.error)):(d.value=!0,w("success",t.data),setTimeout(()=>{d.value=!1},3e3))}catch(v){const t=v.message||"An error occurred while saving your profile";p.value=t,w("error",t)}finally{l.value=!1}}},j=()=>{c.existingProfile?(n.full_name=c.existingProfile.full_name||"",n.phone=c.existingProfile.phone||"",n.location=c.existingProfile.location||null,n.location&&(u.value="success")):C()};return I(()=>{j()}),r({requestLocation:C,validateForm:()=>(N(),U(),E.value),resetForm:j}),(v,t)=>{var M;return i(),a("div",ae,[e("div",le,[e("h2",ue,h(k.value?"Welcome! Let's set up your profile":"Edit Your Profile"),1),e("p",ce,h(k.value?"Please provide some basic information to get started with LocalHelp":"Update your profile information and preferences"),1)]),o.value?(i(),a("div",de,[x(y(S),{icon:"svg-spinners:3-dots-bounce",class:"w-12 h-12 text-secondary-600"}),t[3]||(t[3]=e("p",{class:"mt-4 text-gray-600"},"Loading your profile...",-1))])):(i(),a("form",{key:1,onSubmit:O(B,["prevent"]),class:"space-y-6"},[e("div",pe,[t[8]||(t[8]=e("h3",{class:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2"}," Basic Information ",-1)),e("div",fe,[e("div",null,[t[4]||(t[4]=e("label",{for:"fullName",class:"block text-sm font-medium text-gray-700 mb-2"}," Full Name * ",-1)),A(e("input",{id:"fullName","onUpdate:modelValue":t[0]||(t[0]=$=>n.full_name=$),type:"text",required:"",class:Y(["input",{"border-error-300 focus:border-error-500 focus:ring-error-500":m.full_name}]),placeholder:"Enter your full name"},null,2),[[T,n.full_name]]),m.full_name?(i(),a("p",me,h(m.full_name),1)):b("",!0)]),e("div",null,[t[5]||(t[5]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-2"}," Email Address ",-1)),e("input",{id:"email",value:(M=y(s).user)==null?void 0:M.email,type:"email",disabled:"",class:"input bg-gray-50 text-gray-500"},null,8,ge),t[6]||(t[6]=e("p",{class:"text-xs text-gray-500 mt-1"},"Email cannot be changed",-1))])]),e("div",null,[t[7]||(t[7]=e("label",{for:"phone",class:"block text-sm font-medium text-gray-700 mb-2"}," Phone Number ",-1)),A(e("input",{id:"phone","onUpdate:modelValue":t[1]||(t[1]=$=>n.phone=$),type:"tel",class:Y(["input md:w-1/2",{"border-error-300 focus:border-error-500 focus:ring-error-500":m.phone}]),placeholder:"Enter your phone number (optional)"},null,2),[[T,n.phone]]),m.phone?(i(),a("p",ve,h(m.phone),1)):b("",!0)])]),e("div",ye,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2"},"Location",-1)),x(oe,{modelValue:n.location,"onUpdate:modelValue":t[2]||(t[2]=$=>n.location=$),class:"mb-4"},null,8,["modelValue"])]),p.value?(i(),a("div",_e,[e("div",he,[x(y(S),{icon:"tabler:alert-triangle",class:"w-5 h-5 text-error-400 mr-3 flex-shrink-0"}),e("div",xe,h(p.value),1)])])):b("",!0),d.value?(i(),a("div",be,[e("div",we,[x(y(re),{class:"w-5 h-5 text-success-400 mr-3 flex-shrink-0"}),e("div",Pe,h(k.value?"Profile created successfully!":"Profile updated successfully!"),1)])])):b("",!0),e("div",ke,[x(Q,{loading:l.value,onClick:B,disabled:l.value||!E.value},{default:W(()=>[G(h(k.value?"Create Profile":"Update Profile"),1)]),_:1},8,["loading","disabled"])])],32))])}}}),Le=J($e,[["__scopeId","data-v-3ae1295e"]]),Se={class:"space-y-2"},Ee={class:"flex items-center justify-between text-sm"},Re={class:"text-gray-500"},Ve={class:"w-full bg-gray-200 rounded-full h-3 overflow-hidden"},Fe={class:"h-full flex"},Ne={class:"flex items-center justify-between text-xs text-gray-500"},Ue={class:"flex items-center space-x-4"},Ce={class:"flex items-center space-x-1"},Be={class:"flex items-center space-x-1"},je={key:0,class:"flex items-center space-x-1"},Me=F({__name:"ReputationBar",props:{reputation:{}},setup(_){return(r,g)=>(i(),a("div",Se,[e("div",Ee,[g[0]||(g[0]=e("span",{class:"text-gray-600"},"Reputation",-1)),e("span",Re,h(r.reputation.total)+" interactions ",1)]),e("div",Ve,[e("div",Fe,[r.reputation.positivePercentage>0?(i(),a("div",{key:0,class:"bg-secondary-500 transition-all duration-300",style:R({width:`${r.reputation.positivePercentage}%`})},null,4)):b("",!0),r.reputation.negativePercentage>0?(i(),a("div",{key:1,class:"bg-error-500 transition-all duration-300",style:R({width:`${r.reputation.negativePercentage}%`})},null,4)):b("",!0),r.reputation.unknownPercentage>0?(i(),a("div",{key:2,class:"bg-gray-400 transition-all duration-300",style:R({width:`${r.reputation.unknownPercentage}%`})},null,4)):b("",!0)])]),e("div",Ne,[e("div",Ue,[e("div",Ce,[g[1]||(g[1]=e("div",{class:"w-2 h-2 bg-secondary-500 rounded-full"},null,-1)),e("span",null,h(r.reputation.positive)+" positive",1)]),e("div",Be,[g[2]||(g[2]=e("div",{class:"w-2 h-2 bg-error-500 rounded-full"},null,-1)),e("span",null,h(r.reputation.negative)+" negative",1)]),r.reputation.status==="unknown"?(i(),a("div",je,g[3]||(g[3]=[e("div",{class:"w-2 h-2 bg-gray-400 rounded-full"},null,-1),e("span",null,"Unknown",-1)]))):b("",!0)])])]))}}),qe={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ze={key:0,class:"mt-8"},Ae={class:"card"},Te={key:1,class:"mt-8"},Ye={class:"card"},He={class:"flex items-center justify-between mb-6"},Ie={key:0,class:"flex flex-col items-center py-8"},Qe={key:1,class:"text-center py-8"},We={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},Ge={key:2,class:"space-y-4"},Je=F({__name:"ProfileView",setup(_){const{debug:r,error:g}=X("ProfileView"),c=H(),w=te(),s=ie(),o=P(!1),l=V(()=>c.user?s.getReputationDisplay(c.user.id):{status:"unknown",positive:0,negative:0,total:0,positivePercentage:0,negativePercentage:0,unknownPercentage:100}),p=u=>{r("Profile saved successfully:",u)},d=u=>{u instanceof Error?console.error("Profile error:",u.message):console.error("Profile error:",u)};return I(async()=>{if(c.user){o.value=!0;try{await Promise.all([w.fetchUserListings(c.user.id),s.fetchReputation(c.user.id)])}catch(u){g("Error fetching user data:",u)}finally{o.value=!1}}}),(u,f)=>(i(),a("div",qe,[x(Le,{"existing-profile":y(c).user,onSuccess:p,onError:d},null,8,["existing-profile"]),y(c).user?(i(),a("div",ze,[e("div",Ae,[f[0]||(f[0]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Your Reputation",-1)),x(Me,{reputation:l.value},null,8,["reputation"])])])):b("",!0),y(c).user?(i(),a("div",Te,[e("div",Ye,[e("div",He,[f[2]||(f[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"My Listings",-1)),x(Q,{"icon-left":"tabler:plus",link:{name:"create"}},{default:W(()=>f[1]||(f[1]=[G(" Create Listing ")])),_:1,__:[1]})]),o.value?(i(),a("div",Ie,[x(y(S),{icon:"svg-spinners:3-dots-bounce",class:"w-12 h-12 text-primary-400 mb-4"}),f[3]||(f[3]=e("p",{class:"text-gray-500"},"Loading your listings...",-1))])):y(w).userListings.length===0?(i(),a("div",Qe,[e("div",We,[x(y(S),{icon:"tabler:file-broken",class:"w-8 h-8 text-gray-400"})]),f[4]||(f[4]=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"No listings yet",-1)),f[5]||(f[5]=e("p",{class:"text-gray-600 mb-4"},"Create your first listing to get started",-1))])):(i(),a("div",Ge,[(i(!0),a(Z,null,D(y(w).userListings,m=>(i(),ee(ne,{listing:m},null,8,["listing"]))),256))]))])])):b("",!0)]))}}),rt=J(Je,[["__scopeId","data-v-5b6a495d"]]);export{rt as default};
//# sourceMappingURL=ProfileView-C8IL_xaw.js.map
