import{d as E,u as H,z as J,k as _,A as V,c as r,a as e,t as y,h as n,j as d,I as f,p,F as z,C as q,D as Y,E as N,i as A,B,w as I,n as K,g as P,x as Q,o,_ as F,q as G,G as W,H as X,e as ee,J as te}from"./index-Cwfaiojx.js";import{_ as se,L as le}from"./Text.vue_vue_type_script_setup_true_lang-Cv6843iF.js";import{l as ae,M as ie}from"./Map-CKaJgrhF.js";import{C as x,D as oe}from"./constants-DDm60LNs.js";import{u as ne}from"./location-2vzTZ4MP.js";import{u as re}from"./listings-D2fJ6JDs.js";import{L as R}from"./ListingMini-gdE4hCYL.js";import{L as ue}from"./ReputationBar.vue_vue_type_script_setup_true_lang-C-RWq6Fz.js";import{U as de}from"./UserDisplay-CG58Fqmj.js";import{_ as j}from"./Dropdown.vue_vue_type_script_setup_true_lang-B0_BpkFG.js";import"./DefaultAvatar-BlKPcJpM.js";const ce={class:"overlay-header"},ge={class:"title"},ve={class:"overlay-body"},me={key:0,class:"image-section"},pe=["src","alt"],ye={key:0,class:"image-nav"},fe=["onClick"],he={class:"info-section"},be={class:"category-row"},ke={class:"description"},_e={class:"pills-section"},Ce={class:"details-grid"},we={key:0,class:"detail-item"},$e={class:"detail-value"},Ve={key:1,class:"detail-item"},Le={class:"detail-value"},Se={class:"detail-item"},Be={class:"detail-value"},Ie={class:"detail-item"},xe={class:"detail-value"},Ue={key:2,class:"detail-item"},De={class:"detail-value"},Oe={key:0,class:"user-section"},ze={class:"overlay-footer"},Pe=E({__name:"ListingOverlay",props:{listing:{}},emits:["close","contact"],setup(U,{emit:C}){const v=U,h=Q(),m=H(),u=J(),g=C,b=_(0),w=V(()=>{var t;return((t=x.find(s=>s.value===v.listing.category))==null?void 0:t.label)??"Unknown"}),L=V(()=>{var t;return((t=x.find(s=>s.value===v.listing.category))==null?void 0:t.color)??"#6b7280"}),c=V(()=>{var t;return v.listing.duration_estimate?(t=oe.find(s=>s.value===v.listing.duration_estimate))==null?void 0:t.label:""}),D=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),k=t=>`${t.lat.toFixed(4)}, ${t.lng.toFixed(4)}`,T=async()=>{if(!(!m.user||!v.listing)){if(m.user.id===v.listing.user_id){alert("You cannot start a chat with yourself");return}try{const t=await u.getOrCreateChat(v.listing.id);h.push({name:"chat",params:{id:t}})}catch(t){console.error("Failed to start chat:",t),alert("Failed to start chat. Please try again.")}}};return(t,s)=>{var O;return o(),r("div",{class:"overlay-backdrop",onClick:s[2]||(s[2]=$=>g("close"))},[e("div",{class:"overlay-content",onClick:s[1]||(s[1]=K(()=>{},["stop"]))},[e("div",ce,[e("h2",ge,y(t.listing.title),1),e("button",{class:"close-button",onClick:s[0]||(s[0]=$=>g("close"))},[n(d(f),{icon:"mdi:close",class:"w-6 h-6"})])]),e("div",ve,[(O=t.listing.images)!=null&&O.length?(o(),r("div",me,[e("img",{src:t.listing.images[b.value],alt:t.listing.title,class:"main-image"},null,8,pe),t.listing.images.length>1?(o(),r("div",ye,[(o(!0),r(z,null,q(t.listing.images,($,S)=>(o(),r("button",{key:S,onClick:M=>b.value=S,class:N(["image-dot",{active:S===b.value}])},null,10,fe))),128))])):p("",!0)])):p("",!0),e("div",he,[e("div",be,[e("div",{class:"category-badge",style:Y({backgroundColor:L.value})},y(w.value),5),e("div",{class:N(["status-badge",{active:t.listing.active}])},y(t.listing.active?"Active":"Inactive"),3)]),e("div",ke,[e("p",null,y(t.listing.description),1)]),e("div",_e,[n(ue,{listing:t.listing},null,8,["listing"])]),e("div",Ce,[t.listing.duration_estimate?(o(),r("div",we,[n(d(f),{icon:"mdi:clock-outline",class:"detail-icon"}),s[3]||(s[3]=e("span",{class:"detail-label"},"Duration:",-1)),e("span",$e,y(c.value),1)])):p("",!0),t.listing.compensation?(o(),r("div",Ve,[n(d(f),{icon:"mdi:currency-usd",class:"detail-icon"}),s[4]||(s[4]=e("span",{class:"detail-label"},"Compensation:",-1)),e("span",Le,y(t.listing.compensation),1)])):p("",!0),e("div",Se,[n(d(f),{icon:"mdi:map-marker",class:"detail-icon"}),s[5]||(s[5]=e("span",{class:"detail-label"},"Location:",-1)),e("span",Be,y(k(t.listing.location)),1)]),e("div",Ie,[n(d(f),{icon:"mdi:calendar",class:"detail-icon"}),s[6]||(s[6]=e("span",{class:"detail-label"},"Posted:",-1)),e("span",xe,y(D(t.listing.created_at)),1)]),t.listing.expires_at?(o(),r("div",Ue,[n(d(f),{icon:"mdi:calendar-clock",class:"detail-icon"}),s[7]||(s[7]=e("span",{class:"detail-label"},"Expires:",-1)),e("span",De,y(D(t.listing.expires_at)),1)])):p("",!0)]),t.listing.user?(o(),r("div",Oe,[n(de,{user:t.listing.user,class:"user-info"},null,8,["user"])])):p("",!0)])]),e("div",ze,[n(B,{variant:"outline",link:{name:"show",params:{id:t.listing.id}}},{default:I(()=>s[8]||(s[8]=[P("Details")])),_:1,__:[8]},8,["link"]),d(m).isAuthenticated?(o(),A(B,{key:0,variant:"primary",onClick:T},{default:I(()=>[n(d(f),{icon:"mdi:message",class:"w-4 h-4 mr-2"}),s[9]||(s[9]=P(" Contact "))]),_:1,__:[9]})):(o(),A(B,{key:1,variant:"primary",link:{name:"auth"}},{default:I(()=>[n(d(f),{icon:"mdi:message",class:"w-4 h-4 mr-2"}),s[10]||(s[10]=P(" Log in or Sign Up To Connect "))]),_:1,__:[10]}))])])])}}}),Ae=F(Pe,[["__scopeId","data-v-87441836"]]),Te={class:"checkbox-wrapper"},qe={key:0,class:"checkbox-label"},Ne=["id","required","disabled"],Ee={class:"checkbox-text"},Fe={key:0,class:"text-error-600"},Me={key:1,class:"checkbox-helper"},Re=E({__name:"Checkbox",props:{modelValue:{type:Boolean},label:{},id:{},helper:{},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(U,{emit:C}){const v=U,h=C,m=V({get:()=>v.modelValue,set:u=>h("update:modelValue",u)});return(u,g)=>(o(),r("div",Te,[u.label?(o(),r("label",qe,[G(e("input",{id:u.id,"onUpdate:modelValue":g[0]||(g[0]=b=>m.value=b),type:"checkbox",required:u.required,disabled:u.disabled,class:"checkbox-input",onChange:g[1]||(g[1]=b=>u.$emit("change",m.value))},null,40,Ne),[[W,m.value]]),g[2]||(g[2]=e("span",{class:"checkbox-visual"},null,-1)),e("span",Ee,[P(y(u.label),1),u.required?(o(),r("span",Fe,"*")):p("",!0)])])):p("",!0),u.helper?(o(),r("p",Me,y(u.helper),1)):p("",!0)]))}}),je=F(Re,[["__scopeId","data-v-6e795485"]]),Ge={key:0,class:"browse-view"},Ze={class:"sidebar"},He={class:"w-full"},Je={class:"listing-controls"},Ye={class:"filters"},Ke={key:0},Qe={class:"space-y-4 mt-4 grow overflow-y-scroll"},We={key:1,class:"overlay light"},Xe={key:2,class:"overlay dark"},et=E({__name:"BrowseView",setup(U){const C=ne(),v=re(),h=_(!0),m=_({lat:0,lng:0}),u=_(null),g=_(12),b=_(!1),w=_(null),L=_(!1),c=_({search:"",category:"",subcategory:"",activeOnly:!0}),D=_(""),k=ae.debounce(async()=>{u.value&&await v.fetchListingsInBounds(u.value,c.value)},250),T=i=>{var l;return((l=x.find(a=>a.value===i))==null?void 0:l.color)??"gray"};X(()=>c.value.category,()=>{c.value.subcategory=""});const t=V(()=>{var l;const i=c.value.category;return i?((l=x.find(a=>a.value===i))==null?void 0:l.subcategories)||[]:[]}),s=async()=>{h.value=!0;const i=await le.getCurrentPosition();m.value={lat:i.latitude,lng:i.longitude},g.value=12,C.setViewingLocation({center:m.value,zoom:g.value}),h.value=!1},O=async()=>{if(D.value.trim()===""){k();return}k(),v.listings.length===0&&alert("No listings found for that search.")},$=V(()=>v.listings.map((i,l)=>({index:l+1,lat:i.location.lat,lng:i.location.lng,color:T(i.category),listing:i}))),S=i=>{C.setViewingLocation(i),k()},M=i=>{u.value=i,k()};return ee(async()=>{if(k(),C.viewingLocation){const i=C.viewingLocation;m.value=i.center,g.value=i.zoom}else{const i={longitude:-118.2437,latitude:34.0522};C.setViewingLocation({center:{lat:i.latitude,lng:i.longitude},zoom:12}),m.value={lat:i.latitude,lng:i.longitude}}h.value=!1}),(i,l)=>(o(),r(z,null,[h.value?p("",!0):(o(),r("div",Ge,[e("div",Ze,[e("div",He,[l[8]||(l[8]=e("h2",{class:"text-lg font-semibold p-4"},"Listings",-1)),e("ul",null,[(o(!0),r(z,null,q($.value,a=>(o(),A(R,{key:a.listing.id,index:a.index,listing:a.listing,onClick:Z=>w.value=a.listing,class:"w-full"},null,8,["index","listing","onClick"]))),128))])])]),e("div",null,[n(ie,{class:"absolute w-full h-full",center:m.value,zoom:g.value,minZoom:1,maxZoom:19,pins:$.value,onViewChange:S,onBoundsChange:M,onPinClick:l[0]||(l[0]=a=>w.value=a.listing)},null,8,["center","zoom","pins"]),e("div",Je,[n(se,{modelValue:c.value.search,"onUpdate:modelValue":l[1]||(l[1]=a=>c.value.search=a),placeholder:"Search listings...",class:"w-full md:w-64",onInput:O},null,8,["modelValue"]),n(B,{variant:"gray",onClick:l[2]||(l[2]=a=>L.value=!L.value)},{default:I(()=>[n(d(f),{icon:"tabler:filter",class:"w-6 h-6"})]),_:1}),n(B,{loading:h.value,onClick:s},{default:I(()=>[n(d(f),{icon:"tabler:current-location",class:"w-6 h-6"})]),_:1},8,["loading"])]),G(e("div",Ye,[e("div",null,[n(j,{modelValue:c.value.category,"onUpdate:modelValue":l[3]||(l[3]=a=>c.value.category=a),label:"Category",options:d(x),placeholder:"Select Category",onChange:d(k)},null,8,["modelValue","options","onChange"])]),c.value.category?(o(),r("div",Ke,[n(j,{modelValue:c.value.subcategory,"onUpdate:modelValue":l[4]||(l[4]=a=>c.value.subcategory=a),label:"Subcategory",options:t.value,placeholder:"Select Subcategory",onChange:d(k)},null,8,["modelValue","options","onChange"])])):p("",!0),e("div",null,[n(je,{modelValue:c.value.activeOnly,"onUpdate:modelValue":l[5]||(l[5]=a=>c.value.activeOnly=a),label:"Active Listings Only",onChange:d(k)},null,8,["modelValue","onChange"])])],512),[[te,L.value]]),e("div",{class:N(["pullbar",{active:b.value}])},[e("div",{class:"grabber",onClick:l[6]||(l[6]=a=>b.value=!b.value)},l[9]||(l[9]=[e("div",{class:"grabber-pill"},null,-1)])),e("ul",Qe,[(o(!0),r(z,null,q($.value,a=>(o(),A(R,{key:a.listing.id,index:a.index,listing:a.listing,onClick:Z=>w.value=a.listing,class:"w-full"},null,8,["index","listing","onClick"]))),128))])],2)])])),h.value?(o(),r("div",We,[n(d(f),{icon:"mdi:map-search-outline",class:"text-4xl text-gray-700 animate-bounce"})])):p("",!0),w.value?(o(),r("div",Xe,[n(Ae,{listing:w.value,onClose:l[7]||(l[7]=a=>w.value=null)},null,8,["listing"])])):p("",!0)],64))}}),gt=F(et,[["__scopeId","data-v-1f54f63e"]]);export{gt as default};
//# sourceMappingURL=BrowseView-Bjq9RWqv.js.map
