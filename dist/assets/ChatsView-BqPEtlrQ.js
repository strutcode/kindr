import{d as B,u as j,z as L,c as o,D as z,a as e,h as _,j as u,I as b,p as f,t as y,i as M,g as E,o as t,_ as T,F as A,A as F,k as p,n as G,O as N,G as R,e as q,q as Q,v as X,J as Y,B as H,S as Z,s as ee,x as se}from"./index-WKext-pH.js";import{_ as te}from"./Chip.vue_vue_type_script_setup_true_lang-Chvusv7m.js";const ae={class:"chat-avatar"},oe=["src","alt"],le={key:1,class:"avatar-placeholder"},ne={class:"chat-content"},re={class:"chat-header"},ie={class:"chat-name"},ce={class:"chat-time"},de={class:"chat-info"},ue={class:"listing-title"},he={key:0,class:"last-message"},me={class:"message-preview"},ge={key:0,class:"flex items-center"},_e={key:1},ve={key:0,class:"unread-indicator"},fe=B({__name:"ChatListItem",props:{chat:{},selected:{type:Boolean}},emits:["select"],setup(x){const l=x,i=j(),n={"free-stuff":"Free Stuff","help-needed":"Help Needed","skills-offered":"Skills Offered"},r={"free-stuff":"green","help-needed":"blue","skills-offered":"purple"},s=L(()=>i.user?l.chat.requester_id===i.user.id?l.chat.requester_unread_count>0:l.chat.owner_unread_count>0:!1),m=L(()=>i.user?l.chat.requester_id===i.user.id?l.chat.requester_unread_count:l.chat.owner_unread_count:0),S=a=>{const c=new Date(a),h=new Date().getTime()-c.getTime(),v=Math.floor(h/(1e3*60)),w=Math.floor(h/(1e3*60*60)),$=Math.floor(h/(1e3*60*60*24));return v<1?"Just now":v<60?`${v}m`:w<24?`${w}h`:$<7?`${$}d`:c.toLocaleDateString(void 0,{month:"short",day:"numeric"})};return(a,c)=>{var g,h,v,w;return t(),o("div",{class:z(["chat-list-item",{selected:a.selected,unread:s.value}]),onClick:c[0]||(c[0]=$=>a.$emit("select"))},[e("div",ae,[(g=a.chat.other_user)!=null&&g.avatar_url?(t(),o("img",{key:0,src:a.chat.other_user.avatar_url,alt:a.chat.other_user.full_name||"User",class:"avatar-image"},null,8,oe)):(t(),o("div",le,[_(u(b),{icon:"tabler:user-filled",class:"h-7 w-7 text-gray-500"})]))]),e("div",ne,[e("div",re,[e("h3",ie,y(((h=a.chat.other_user)==null?void 0:h.full_name)||"Anonymous"),1),e("span",ce,y(S(a.chat.last_message_at)),1)]),e("div",de,[e("p",ue,y(((v=a.chat.listing)==null?void 0:v.title)||"Unknown listing"),1),(w=a.chat.listing)!=null&&w.category?(t(),M(te,{key:0,label:n[a.chat.listing.category],color:r[a.chat.listing.category],size:"xs"},null,8,["label","color"])):f("",!0)]),a.chat.last_message?(t(),o("div",he,[e("p",me,[a.chat.last_message.message_type==="image"?(t(),o("span",ge,c[1]||(c[1]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),E(" Photo ")]))):(t(),o("span",_e,y(a.chat.last_message.content),1))]),s.value?(t(),o("div",ve,y(m.value>99?"99+":m.value),1)):f("",!0)])):f("",!0)])],2)}}}),pe=T(fe,[["__scopeId","data-v-85c20233"]]),ye={class:"chat-list"},ke={class:"chat-list-header"},be={key:0,class:"text-sm text-gray-500"},$e={class:"chat-list-content"},we={key:0,class:"empty-state"},Ce={key:1,class:"chat-items"},xe=B({__name:"ChatList",props:{chats:{},loading:{type:Boolean},selectedChatId:{}},emits:["select-chat"],setup(x){return(l,i)=>(t(),o("div",ye,[e("div",ke,[i[0]||(i[0]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Messages",-1)),l.loading?(t(),o("div",be,"Loading...")):f("",!0)]),e("div",$e,[l.chats.length===0&&!l.loading?(t(),o("div",we,[_(u(b),{icon:"tabler:message-circle",class:"mx-auto h-8 w-8 text-gray-400 mb-3"}),i[1]||(i[1]=e("p",{class:"text-sm text-gray-500 text-center"},"No messages yet",-1)),i[2]||(i[2]=e("p",{class:"text-xs text-gray-400 text-center mt-1"},"Start a conversation about a listing",-1))])):(t(),o("div",Ce,[(t(!0),o(A,null,F(l.chats,n=>(t(),M(pe,{key:n.id,chat:n,selected:n.id===l.selectedChatId,onSelect:r=>l.$emit("select-chat",n.id)},null,8,["chat","selected","onSelect"]))),128))]))])]))}}),V=T(xe,[["__scopeId","data-v-38a09470"]]),Me={key:0,class:"message-avatar"},Se=["src","alt"],Ie={key:1,class:"avatar-placeholder"},Le={class:"message-content"},Be={key:0,class:"sender-name"},Te={class:"message-bubble"},Ue={key:0,class:"text-message"},Oe={key:1,class:"image-message"},Ve=["src","alt"],De={class:"message-time"},je=["src","alt"],ze=B({__name:"ChatMessage",props:{message:{},isOwn:{type:Boolean}},setup(x){const l=p(!1),i=()=>{l.value=!0},n=()=>{l.value=!1},r=s=>new Date(s).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0});return(s,m)=>(t(),o("div",{class:z(["message",{"own-message":s.isOwn,"other-message":!s.isOwn}])},[s.isOwn?f("",!0):(t(),o("div",Me,[s.message.sender_avatar_url?(t(),o("img",{key:0,src:s.message.sender_avatar_url,alt:s.message.sender_name,class:"avatar-image"},null,8,Se)):(t(),o("div",Ie,[_(u(b),{icon:"tabler:user-filled",class:"h-5 w-5 text-gray-500"})]))])),e("div",Le,[s.isOwn?f("",!0):(t(),o("div",Be,y(s.message.sender_name),1)),e("div",Te,[s.message.message_type==="text"?(t(),o("div",Ue,y(s.message.content),1)):s.message.message_type==="image"?(t(),o("div",Oe,[e("img",{src:s.message.image_url,alt:"Image from "+s.message.sender_name,class:"message-image",onClick:i},null,8,Ve)])):f("",!0)]),e("div",De,y(r(s.message.created_at)),1)]),l.value&&s.message.message_type==="image"?(t(),o("div",{key:1,class:"image-modal",onClick:n},[e("div",{class:"image-modal-content",onClick:m[0]||(m[0]=G(()=>{},["stop"]))},[e("img",{src:s.message.image_url,alt:"Image from "+s.message.sender_name,class:"modal-image"},null,8,je),e("button",{onClick:n,class:"close-modal-button"},[_(u(b),{icon:"tabler:user-filled",class:"h-6 w-6 text-gray-500"})])])])):f("",!0)],2))}}),Ae=T(ze,[["__scopeId","data-v-7c970524"]]),Fe={class:"chat-window"},Ne={key:0,class:"load-more-container"},Re={class:"messages-list"},qe={class:"message-input-container"},He={class:"message-input-wrapper"},We=["disabled"],Je=["disabled"],Ke={key:0,class:"image-preview-container"},Pe={class:"image-preview"},Ee=["src"],Ge=["disabled"],Qe={key:0},Xe={key:1},Ye=B({__name:"ChatWindow",props:{chat:{},messages:{}},setup(x){const l=x,i=j(),n=N(),r=p(""),s=p(!1),m=p(!1),S=p(),a=p(),c=p(),g=p(null),h=p(""),v=L(()=>[...l.messages].reverse()),w=L(()=>n.hasMore[l.chat.id]??!1),$=(d=!0)=>{Z(()=>{a.value&&a.value.scrollIntoView({behavior:d?"smooth":"auto",block:"end"})})},U=async()=>{const d=r.value.trim();if(!(!d||s.value)){s.value=!0;try{await n.sendMessage(l.chat.id,d),r.value="",$()}catch(C){console.error("Failed to send message:",C)}finally{s.value=!1}}},W=()=>{var d;(d=c.value)==null||d.click()},J=d=>{var I;const k=(I=d.target.files)==null?void 0:I[0];k&&(g.value=k,h.value=URL.createObjectURL(k))},K=async()=>{if(!(!g.value||s.value)){s.value=!0;try{await n.uploadChatImage(g.value,l.chat.id),O(),$()}catch(d){console.error("Failed to send image:",d)}finally{s.value=!1}}},O=()=>{g.value=null,h.value&&(URL.revokeObjectURL(h.value),h.value=""),c.value&&(c.value.value="")},P=()=>{try{m.value=!0,n.loadMoreMessages(l.chat.id)}catch(d){console.error("Failed to load more messages:",d)}finally{m.value=!1}};return R(()=>l.messages.length,(d,C)=>{d>C&&$()}),q(()=>{$(!1)}),(d,C)=>(t(),o("div",Fe,[e("div",{class:"messages-container",ref_key:"messagesContainer",ref:S},[w.value?(t(),o("div",Ne,[e("button",{onClick:P,class:"load-more-button"},"Load older messages")])):f("",!0),e("div",Re,[(t(!0),o(A,null,F(v.value,k=>{var I;return t(),M(Ae,{key:k.id,message:k,"is-own":k.sender_id===((I=u(i).user)==null?void 0:I.id)},null,8,["message","is-own"])}),128))]),e("div",{ref_key:"bottomAnchor",ref:a},null,512)],512),e("div",qe,[e("div",He,[e("button",{variant:"ghost",onClick:W,class:"image-upload-button",title:"Send image"},[_(u(b),{icon:"tabler:photo-up",class:"w-5 h-5 text-gray-600"})]),Q(e("input",{"onUpdate:modelValue":C[0]||(C[0]=k=>r.value=k),type:"text",placeholder:"Type a message...",class:"message-input",onKeydown:Y(U,["enter"]),disabled:s.value},null,40,We),[[X,r.value]]),e("button",{onClick:U,disabled:!r.value.trim()||s.value,class:"send-button"},[s.value?(t(),M(u(b),{key:1,icon:"svg-spinners:90-ring-with-bg",class:"w-5 h-5 animate-spin text-primary-600"})):(t(),M(u(b),{key:0,icon:"tabler:send",class:"w-5 h-5"}))],8,Je),e("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/*",onChange:J,class:"hidden"},null,544)]),g.value?(t(),o("div",Ke,[e("div",Pe,[e("img",{src:h.value,alt:"Selected image",class:"preview-image"},null,8,Ee),_(H,{onClick:O,"icon-left":"tabler-x",class:"cancel-image-button"})]),e("button",{onClick:K,disabled:s.value,class:"send-image-button"},[s.value?(t(),o("span",Xe,"Sending...")):(t(),o("span",Qe,"Send Photo"))],8,Ge)])):f("",!0)])]))}}),D=T(Ye,[["__scopeId","data-v-713331f3"]]),Ze={class:"chats-container"},es={class:"hidden md:flex h-full"},ss={class:"w-80 border-r border-gray-200 flex flex-col bg-white"},ts={class:"flex-1 flex flex-col"},as={key:1,class:"flex-1 flex items-center justify-center text-gray-500"},os={class:"text-center"},ls={class:"md:hidden h-full flex flex-col"},ns={key:0,class:"flex-1"},rs={key:1,class:"flex-1 flex flex-col"},is={class:"bg-white border-b border-gray-200 px-4 py-3 flex items-center"},cs={class:"flex items-center"},ds=["src","alt"],us={key:1,class:"w-8 h-8 rounded-full bg-gray-300 mr-3 flex items-center justify-center"},hs={class:"font-medium text-gray-900"},ms={class:"text-sm text-gray-500"},gs=B({__name:"ChatsView",setup(x){const l=ee(),i=se(),n=N(),r=p(null),s=L(()=>r.value?n.chats.find(a=>a.id===r.value):null),m=a=>{r.value=a,n.setCurrentChat(a),window.innerWidth>=768?i.replace({name:"chat",params:{id:a}}):i.push({name:"chat",params:{id:a}})},S=()=>{r.value=null,n.setCurrentChat(null),i.push({name:"chats"})};return R(()=>l.params.id,a=>{a&&typeof a=="string"?(r.value=a,n.setCurrentChat(a)):l.name==="chats"&&(r.value=null,n.setCurrentChat(null))},{immediate:!0}),q(()=>{n.initialize()}),(a,c)=>{var g,h,v;return t(),o("div",Ze,[e("div",es,[e("div",ss,[_(V,{chats:u(n).sortedChats,loading:u(n).loading,"selected-chat-id":r.value,onSelectChat:m},null,8,["chats","loading","selected-chat-id"])]),e("div",ts,[r.value&&s.value?(t(),M(D,{key:0,chat:s.value,messages:u(n).currentMessages},null,8,["chat","messages"])):(t(),o("div",as,[e("div",os,[_(u(b),{icon:"tabler:message-circle",class:"mx-auto h-12 w-12 text-gray-400 mb-4"}),c[0]||(c[0]=e("p",{class:"text-lg font-medium"},"Select a chat to start messaging",-1)),c[1]||(c[1]=e("p",{class:"text-sm text-gray-400 mt-1"},"Choose from your existing conversations",-1))])]))])]),e("div",ls,[r.value?s.value?(t(),o("div",rs,[e("div",is,[_(H,{variant:"ghost",size:"lg",onClick:S,"icon-left":"tabler:chevron-left",class:"mr-3 p-1 text-2xl text-gray-600 hover:bg-primary-100"}),e("div",cs,[(g=s.value.other_user)!=null&&g.avatar_url?(t(),o("img",{key:0,src:s.value.other_user.avatar_url,alt:s.value.other_user.full_name||"User",class:"w-8 h-8 rounded-full mr-3"},null,8,ds)):(t(),o("div",us,[_(u(b),{icon:"tabler:user-filled",class:"h-5 w-5 text-gray-500"})])),e("div",null,[e("h2",hs,y(((h=s.value.other_user)==null?void 0:h.full_name)||"Anonymous"),1),e("p",ms,y((v=s.value.listing)==null?void 0:v.title),1)])])]),_(D,{chat:s.value,messages:u(n).currentMessages},null,8,["chat","messages"])])):f("",!0):(t(),o("div",ns,[c[2]||(c[2]=e("div",{class:"bg-white border-b border-gray-200 px-4 py-3"},[e("h1",{class:"text-lg font-semibold text-gray-900"},"Messages")],-1)),_(V,{chats:u(n).sortedChats,loading:u(n).loading,"selected-chat-id":null,onSelectChat:m},null,8,["chats","loading"])]))])])}}}),fs=T(gs,[["__scopeId","data-v-7c5711f5"]]);export{fs as default};
//# sourceMappingURL=ChatsView-BqPEtlrQ.js.map
