import{C as P,D as C}from"./constants-DDm60LNs.js";import{d as x,A as _,c,a as r,p as w,E as m,t as v,F as b,C as k,o as p,_ as R,Q as E,k as y,T as h,y as f}from"./index-Cwfaiojx.js";const S={class:"listing-pills"},T={class:"pill"},A=x({__name:"ListingPills",props:{listing:{}},setup(l){const i=l,d=_(()=>{var s,e,n;return i.listing.subcategory?(n=(e=(s=P.find(t=>t.value===i.listing.category))==null?void 0:s.subcategories)==null?void 0:e.find(t=>t.value===i.listing.subcategory))==null?void 0:n.label:""}),a=_(()=>{var s;return i.listing.category==="help-needed"?(s=C.find(e=>e.value===i.listing.duration_estimate))==null?void 0:s.label:""});return(s,e)=>(p(),c("div",S,[r("p",{class:m(["pill",s.listing.subcategory])},v(d.value),3),(p(!0),c(b,null,k(s.listing.skills_required,n=>(p(),c("p",T,v(n),1))),256)),s.listing.duration_estimate?(p(),c("p",{key:0,class:m(["pill",s.listing.duration_estimate])},v(a.value),3)):w("",!0)]))}}),q=R(A,[["__scopeId","data-v-e3661e06"]]),F=E("reputation",()=>{const l=y({}),i=y(!1),d=e=>{const n=l.value[e];if(!n)return{status:"unknown",positive:0,negative:0,total:0,positivePercentage:0,negativePercentage:0,unknownPercentage:100};const t=n.positive_points+n.negative_points,u=n.positive_points/Math.max(t,10)*100,o=n.negative_points/Math.max(t,10)*100,g=100-(u+o);return{status:"known",positive:n.positive_points,negative:n.negative_points,total:t,positivePercentage:u,negativePercentage:o,unknownPercentage:g}},a=async e=>{if(!l.value[e]){i.value=!0;try{const{data:n,error:t}=await f.from("reputation").select("*").eq("user_id",e).maybeSingle();if(t)throw t;if(n)l.value[e]=n;else{const{data:u,error:o}=await f.from("reputation").insert([{user_id:e,positive_points:0,negative_points:0,total_interactions:0}]).select().single();if(o)throw o;l.value[e]=u}}catch(n){console.error("Error fetching reputation:",n)}finally{i.value=!1}}},s=async e=>{i.value=!0;try{const{data:n,error:t}=await f.from("reviews").insert([e]).select().single();if(t)throw t;let u=0,o=0;e.punctuality==="on-time"?u+=5:e.punctuality==="late"?o+=3:e.punctuality==="no-show"&&(o+=10),e.helpfulness==="helpful"?u+=5:e.helpfulness==="unhelpful"&&(o+=3),e.accuracy==="as-described"?u+=5:e.accuracy==="not-as-described"&&(o+=5);const{error:g}=await f.rpc("update_reputation",{user_id:e.reviewee_id,positive_delta:u,negative_delta:o});if(g)throw g;return delete l.value[e.reviewee_id],await a(e.reviewee_id),{data:n,error:null}}catch(n){return{data:null,error:n.message}}finally{i.value=!1}};return{reputations:h(l),loading:h(i),getReputationDisplay:d,fetchReputation:a,submitReview:s}}),B={class:"space-y-2 w-full"},L={class:"w-full flex space-x-1"},M={class:"flex items-center justify-between text-xs text-gray-500"},N={class:"flex items-center space-x-4"},O={key:0,class:"flex items-center space-x-1"},U=x({__name:"ReputationBar",props:{reputation:{}},setup(l){const i=l,d=_(()=>{const a=[],s=Math.round(i.reputation.positivePercentage/10),e=Math.round(i.reputation.negativePercentage/10),n=10-s-e;for(let t=0;t<s;t++)a.push({index:t,colorClass:"bg-primary-500"});for(let t=0;t<e;t++)a.push({index:t,colorClass:"bg-error-500"});for(let t=0;t<n;t++)a.push({index:t,colorClass:"bg-gray-400"});return a});return(a,s)=>(p(),c("div",B,[s[3]||(s[3]=r("div",{class:"flex items-center justify-between text-sm"},[r("span",{class:"text-gray-600"},"Reputation")],-1)),r("div",L,[(p(!0),c(b,null,k(d.value,e=>(p(),c("div",{key:e.index,class:m(["flex-1 h-3 rounded-full transition-all duration-300",e.colorClass])},null,2))),128))]),r("div",M,[r("div",N,[s[1]||(s[1]=r("div",{class:"flex items-center space-x-1"},[r("div",{class:"w-2 h-2 bg-primary-500 rounded-full"}),r("span",null,"positive")],-1)),s[2]||(s[2]=r("div",{class:"flex items-center space-x-1"},[r("div",{class:"w-2 h-2 bg-error-500 rounded-full"}),r("span",null,"negative")],-1)),a.reputation.status==="unknown"?(p(),c("div",O,s[0]||(s[0]=[r("div",{class:"w-2 h-2 bg-gray-400 rounded-full"},null,-1),r("span",null,"Unknown",-1)]))):w("",!0)])])]))}});export{q as L,U as _,F as u};
//# sourceMappingURL=ReputationBar.vue_vue_type_script_setup_true_lang-C-RWq6Fz.js.map
