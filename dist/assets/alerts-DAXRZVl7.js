import{Q as E,u as p,k as _,z as n,y as s}from"./index-WKext-pH.js";const x=E("alerts",()=>{const o=p(),e=_({alerts:[],loading:!1,error:null}),g=n(()=>e.value.alerts),v=n(()=>e.value.loading),h=n(()=>e.value.error),w=n(()=>e.value.alerts.filter(t=>t.active)),m=()=>{e.value.error=null},i=async()=>{if(o.user)try{e.value.loading=!0,e.value.error=null;const{data:t,error:r}=await s.from("alerts").select("*").eq("user_id",o.user.id).order("created_at",{ascending:!1});if(r)throw r;e.value.alerts=(t==null?void 0:t.map(a=>({...a,location:{lat:a.location.coordinates[1],lng:a.location.coordinates[0]}})))||[]}catch(t){console.error("Error fetching alerts:",t),e.value.error=t instanceof Error?t.message:"Failed to fetch alerts"}finally{e.value.loading=!1}},y=async t=>{if(!o.user)throw new Error("Not authenticated");try{e.value.loading=!0,e.value.error=null;const{data:r,error:a}=await s.from("alerts").insert({user_id:o.user.id,name:t.name,location:`POINT(${t.location.lng} ${t.location.lat})`,radius_meters:t.radius_meters,category:t.category||null}).select().single();if(a)throw a;const l={...r,location:{lat:r.location.coordinates[1],lng:r.location.coordinates[0]}};return e.value.alerts.unshift(l),l}catch(r){throw console.error("Error creating alert:",r),e.value.error=r instanceof Error?r.message:"Failed to create alert",r}finally{e.value.loading=!1}},c=async(t,r)=>{if(!o.user)throw new Error("Not authenticated");try{e.value.loading=!0,e.value.error=null;const a={...r};r.location&&(a.location=`POINT(${r.location.lng} ${r.location.lat})`),delete a.id,delete a.user_id,delete a.created_at,a.updated_at=new Date().toISOString();const{data:l,error:u}=await s.from("alerts").update(a).eq("id",t).eq("user_id",o.user.id).select().single();if(u)throw u;const d={...l,location:{lat:l.location.coordinates[1],lng:l.location.coordinates[0]}},f=e.value.alerts.findIndex(A=>A.id===t);return f>=0&&(e.value.alerts[f]=d),d}catch(a){throw console.error("Error updating alert:",a),e.value.error=a instanceof Error?a.message:"Failed to update alert",a}finally{e.value.loading=!1}};return{alerts:g,loading:v,error:h,activeAlerts:w,clearError:m,fetchAlerts:i,createAlert:y,updateAlert:c,deleteAlert:async t=>{if(!o.user)throw new Error("Not authenticated");try{e.value.loading=!0,e.value.error=null;const{error:r}=await s.from("alerts").delete().eq("id",t).eq("user_id",o.user.id);if(r)throw r;e.value.alerts=e.value.alerts.filter(a=>a.id!==t)}catch(r){throw console.error("Error deleting alert:",r),e.value.error=r instanceof Error?r.message:"Failed to delete alert",r}finally{e.value.loading=!1}},toggleAlert:async t=>{const r=e.value.alerts.find(a=>a.id===t);r&&await c(t,{active:!r.active})},initialize:()=>{o.user&&i()},cleanup:()=>{e.value.alerts=[],e.value.loading=!1,e.value.error=null}}});export{x as useAlertsStore};
//# sourceMappingURL=alerts-DAXRZVl7.js.map
