{"version":3,"file":"AuthCallbackView-Cb7sTfV0.js","sources":["../../src/views/AuthCallbackView.vue"],"sourcesContent":["<template>\n  <div class=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n    <div class=\"text-center\">\n      <Icon\n        name=\"svg-spinners:bars-scale\"\n        class=\"w-12 h-12 mx-auto text-secondary-600 animate-spin\"\n      />\n      <p class=\"mt-4 text-gray-600\">Completing sign in...</p>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\n  import { onMounted } from 'vue'\n  import { useRouter } from 'vue-router'\n  import { supabase } from '@/lib/supabase'\n  import { useAuthStore } from '@/stores/auth'\n\n  const router = useRouter()\n  const authStore = useAuthStore()\n\n  onMounted(async () => {\n    try {\n      const { data, error } = await supabase.auth.getSession()\n\n      if (error) {\n        console.error('Auth callback error:', error)\n        router.push('/auth')\n        return\n      }\n\n      if (data.session) {\n        // Check if user profile exists, if not create one\n        const { data: profile, error: profileError } = await supabase\n          .from('users')\n          .select('*')\n          .eq('id', data.session.user.id)\n          .maybeSingle()\n\n        if (profileError) {\n          console.error('Error checking profile:', profileError)\n          router.push('/auth')\n          return\n        }\n\n        if (!profile) {\n          // Profile doesn't exist, create one\n          const { error: createError } = await supabase.from('users').insert([\n            {\n              id: data.session.user.id,\n              email: data.session.user.email,\n              full_name:\n                data.session.user.user_metadata.full_name ||\n                data.session.user.user_metadata.name ||\n                '',\n              avatar_url: data.session.user.user_metadata.avatar_url,\n            },\n          ])\n\n          if (createError) {\n            console.error('Error creating profile:', createError)\n            router.push('/auth')\n            return\n          }\n        }\n\n        // Ensure the auth store is synchronized with the user profile\n        await authStore.fetchUserProfile(data.session.user.id)\n\n        router.push('/requests')\n      } else {\n        router.push('/auth')\n      }\n    } catch (error) {\n      console.error('Auth callback error:', error)\n      router.push('/auth')\n    }\n  })\n</script>\n"],"names":["router","useRouter","authStore","useAuthStore","onMounted","data","error","supabase","profile","profileError","createError","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_Icon","_cache"],"mappings":"kPAkBE,MAAMA,EAASC,EAAU,EACnBC,EAAYC,EAAa,EAE/B,OAAAC,EAAU,SAAY,CAChB,GAAA,CACF,KAAM,CAAE,KAAAC,EAAM,MAAAC,CAAA,EAAU,MAAMC,EAAS,KAAK,WAAW,EAEvD,GAAID,EAAO,CACD,QAAA,MAAM,uBAAwBA,CAAK,EAC3CN,EAAO,KAAK,OAAO,EACnB,MAAA,CAGF,GAAIK,EAAK,QAAS,CAEV,KAAA,CAAE,KAAMG,EAAS,MAAOC,GAAiB,MAAMF,EAClD,KAAK,OAAO,EACZ,OAAO,GAAG,EACV,GAAG,KAAMF,EAAK,QAAQ,KAAK,EAAE,EAC7B,YAAY,EAEf,GAAII,EAAc,CACR,QAAA,MAAM,0BAA2BA,CAAY,EACrDT,EAAO,KAAK,OAAO,EACnB,MAAA,CAGF,GAAI,CAACQ,EAAS,CAEN,KAAA,CAAE,MAAOE,GAAgB,MAAMH,EAAS,KAAK,OAAO,EAAE,OAAO,CACjE,CACE,GAAIF,EAAK,QAAQ,KAAK,GACtB,MAAOA,EAAK,QAAQ,KAAK,MACzB,UACEA,EAAK,QAAQ,KAAK,cAAc,WAChCA,EAAK,QAAQ,KAAK,cAAc,MAChC,GACF,WAAYA,EAAK,QAAQ,KAAK,cAAc,UAAA,CAC9C,CACD,EAED,GAAIK,EAAa,CACP,QAAA,MAAM,0BAA2BA,CAAW,EACpDV,EAAO,KAAK,OAAO,EACnB,MAAA,CACF,CAIF,MAAME,EAAU,iBAAiBG,EAAK,QAAQ,KAAK,EAAE,EAErDL,EAAO,KAAK,WAAW,CAAA,MAEvBA,EAAO,KAAK,OAAO,QAEdM,EAAO,CACN,QAAA,MAAM,uBAAwBA,CAAK,EAC3CN,EAAO,KAAK,OAAO,CAAA,CACrB,CACD,4BA5ED,OAAAW,EAAA,EAAAC,EAQM,MARNC,EAQM,CAPJC,EAMM,MANNC,EAMM,CALJC,EAGEC,EAAA,CAFA,KAAK,0BACL,MAAM,mDAAA,GAERC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAJ,EAAuD,IAApD,CAAA,MAAM,sBAAqB,wBAAqB,EAAA"}