import{d as L,u as B,A as T,c as o,E as W,a as e,i as x,p as f,t as k,g as J,o as t,_ as D,h as y,j as m,I as $,F as R,C as j,k as w,n as q,z,H as F,e as H,q as G,v as Q,K as X,B as N,T as Z,s as ee,x as se}from"./index-BGnEo6Zc.js";import{_ as te}from"./Chip.vue_vue_type_script_setup_true_lang-C_-WEaxW.js";import{D as ae}from"./DefaultAvatar-DGkQguvg.js";const oe={class:"chat-avatar"},ne=["src","alt"],le={class:"chat-content"},re={class:"chat-header"},ie={class:"chat-name"},ce={class:"chat-time"},de={class:"chat-info"},ue={class:"listing-title"},me={key:0,class:"last-message"},he={class:"message-preview"},ge={key:0,class:"flex items-center"},_e={key:1},ve={key:0,class:"unread-indicator"},fe=L({__name:"ChatListItem",props:{chat:{},selected:{type:Boolean}},emits:["select"],setup(S){const n=S,c=B(),a={"free-stuff":"Free Stuff","help-needed":"Help Needed","skills-offered":"Skills Offered"},_={"free-stuff":"green","help-needed":"blue","skills-offered":"purple"},s=T(()=>c.user?n.chat.requester_id===c.user.id?n.chat.requester_unread_count>0:n.chat.owner_unread_count>0:!1),d=T(()=>c.user?n.chat.requester_id===c.user.id?n.chat.requester_unread_count:n.chat.owner_unread_count:0),I=l=>{const h=new Date(l),i=new Date().getTime()-h.getTime(),g=Math.floor(i/(1e3*60)),v=Math.floor(i/(1e3*60*60)),p=Math.floor(i/(1e3*60*60*24));return g<1?"Just now":g<60?`${g}m`:v<24?`${v}h`:p<7?`${p}d`:h.toLocaleDateString(void 0,{month:"short",day:"numeric"})};return(l,h)=>{var r,i,g,v;return t(),o("div",{class:W(["chat-list-item",{selected:l.selected,unread:s.value}]),onClick:h[0]||(h[0]=p=>l.$emit("select"))},[e("div",oe,[(r=l.chat.other_user)!=null&&r.avatar_url?(t(),o("img",{key:0,src:l.chat.other_user.avatar_url,alt:l.chat.other_user.full_name||"User",class:"avatar-image"},null,8,ne)):l.chat.other_user?(t(),x(ae,{key:1,user:l.chat.other_user},null,8,["user"])):f("",!0)]),e("div",le,[e("div",re,[e("h3",ie,k(((i=l.chat.other_user)==null?void 0:i.full_name)||"Anonymous"),1),e("span",ce,k(I(l.chat.last_message_at)),1)]),e("div",de,[e("p",ue,k(((g=l.chat.listing)==null?void 0:g.title)||"Unknown listing"),1),(v=l.chat.listing)!=null&&v.category?(t(),x(te,{key:0,label:a[l.chat.listing.category],color:_[l.chat.listing.category],size:"xs"},null,8,["label","color"])):f("",!0)]),l.chat.last_message?(t(),o("div",me,[e("p",he,[l.chat.last_message.message_type==="image"?(t(),o("span",ge,h[1]||(h[1]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),J(" Photo ")]))):(t(),o("span",_e,k(l.chat.last_message.content),1))]),s.value?(t(),o("div",ve,k(d.value>99?"99+":d.value),1)):f("",!0)])):f("",!0)])],2)}}}),pe=D(fe,[["__scopeId","data-v-2f7401f7"]]),ye={class:"chat-list"},we={class:"chat-list-header"},ke={key:0,class:"text-sm text-gray-500"},be={class:"chat-list-content"},$e={key:0,class:"empty-state"},Ce={key:1,class:"chat-items"},xe=L({__name:"ChatList",props:{chats:{},loading:{type:Boolean},selectedChatId:{}},emits:["select-chat"],setup(S){return(n,c)=>(t(),o("div",ye,[e("div",we,[c[0]||(c[0]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Messages",-1)),n.loading?(t(),o("div",ke,"Loading...")):f("",!0)]),e("div",be,[n.chats.length===0&&!n.loading?(t(),o("div",$e,[y(m($),{icon:"tabler:message-circle",class:"mx-auto h-8 w-8 text-gray-400 mb-3"}),c[1]||(c[1]=e("p",{class:"text-sm text-gray-500 text-center"},"No messages yet",-1)),c[2]||(c[2]=e("p",{class:"text-xs text-gray-400 text-center mt-1"},"Start a conversation about a listing",-1))])):(t(),o("div",Ce,[(t(!0),o(R,null,j(n.chats,a=>(t(),x(pe,{key:a.id,chat:a,selected:a.id===n.selectedChatId,onSelect:_=>n.$emit("select-chat",a.id)},null,8,["chat","selected","onSelect"]))),128))]))])]))}}),A=D(xe,[["__scopeId","data-v-38a09470"]]),Se={key:0,class:"message-avatar"},Ie=["src","alt"],Me={key:1,class:"avatar-placeholder"},Te={class:"message-content"},Le={key:0,class:"sender-name"},De={class:"message-bubble"},Be={key:0,class:"text-message"},Oe={key:1,class:"image-message"},Ue=["src","alt"],Ae={class:"message-time"},Ve=["src","alt"],We=L({__name:"ChatMessage",props:{message:{},isOwn:{type:Boolean}},setup(S){const n=w(!1),c=()=>{n.value=!0},a=()=>{n.value=!1},_=s=>new Date(s).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0});return(s,d)=>(t(),o("div",{class:W(["message",{"own-message":s.isOwn,"other-message":!s.isOwn}])},[s.isOwn?f("",!0):(t(),o("div",Se,[s.message.sender_avatar_url?(t(),o("img",{key:0,src:s.message.sender_avatar_url,alt:s.message.sender_name,class:"avatar-image"},null,8,Ie)):(t(),o("div",Me,[y(m($),{icon:"tabler:user-filled",class:"h-5 w-5 text-gray-500"})]))])),e("div",Te,[s.isOwn?f("",!0):(t(),o("div",Le,k(s.message.sender_name),1)),e("div",De,[s.message.message_type==="text"?(t(),o("div",Be,k(s.message.content),1)):s.message.message_type==="image"?(t(),o("div",Oe,[e("img",{src:s.message.image_url,alt:"Image from "+s.message.sender_name,class:"message-image",onClick:c},null,8,Ue)])):f("",!0)]),e("div",Ae,k(_(s.message.created_at)),1)]),n.value&&s.message.message_type==="image"?(t(),o("div",{key:1,class:"image-modal",onClick:a},[e("div",{class:"image-modal-content",onClick:d[0]||(d[0]=q(()=>{},["stop"]))},[e("img",{src:s.message.image_url,alt:"Image from "+s.message.sender_name,class:"modal-image"},null,8,Ve),e("button",{onClick:a,class:"close-modal-button"},[y(m($),{icon:"tabler:user-filled",class:"h-6 w-6 text-gray-500"})])])])):f("",!0)],2))}}),Re=D(We,[["__scopeId","data-v-7c970524"]]),je={class:"chat-window"},qe={key:0,class:"load-more-container"},ze={class:"messages-list"},Fe={class:"message-input-container"},He={class:"message-input-wrapper"},Ne=["disabled"],Ye=["disabled"],Ee={key:0,class:"image-preview-container"},Ke={class:"image-preview"},Pe=["src"],Je=["disabled"],Ge={key:0},Qe={key:1},Xe=L({__name:"ChatWindow",props:{chat:{},messages:{}},setup(S){const n=S,c=B(),a=z(),_=w(""),s=w(!1),d=w(!1),I=w(),l=w(),h=w(),r=w(null),i=w(""),g=T(()=>[...n.messages].reverse()),v=T(()=>a.hasMore[n.chat.id]??!1),p=(u=!0)=>{Z(()=>{l.value&&l.value.scrollIntoView({behavior:u?"smooth":"auto",block:"end"})})},O=async()=>{const u=_.value.trim();if(!(!u||s.value)){s.value=!0;try{await a.sendMessage(n.chat.id,u),_.value="",p()}catch(C){console.error("Failed to send message:",C)}finally{s.value=!1}}},Y=()=>{var u;(u=h.value)==null||u.click()},E=u=>{var M;const b=(M=u.target.files)==null?void 0:M[0];b&&(r.value=b,i.value=URL.createObjectURL(b))},K=async()=>{if(!(!r.value||s.value)){s.value=!0;try{await a.uploadChatImage(r.value,n.chat.id),U(),p()}catch(u){console.error("Failed to send image:",u)}finally{s.value=!1}}},U=()=>{r.value=null,i.value&&(URL.revokeObjectURL(i.value),i.value=""),h.value&&(h.value.value="")},P=()=>{try{d.value=!0,a.loadMoreMessages(n.chat.id)}catch(u){console.error("Failed to load more messages:",u)}finally{d.value=!1}};return F(()=>n.messages.length,(u,C)=>{u>C&&p()}),H(()=>{p(!1)}),(u,C)=>(t(),o("div",je,[e("div",{class:"messages-container",ref_key:"messagesContainer",ref:I},[v.value?(t(),o("div",qe,[e("button",{onClick:P,class:"load-more-button"},"Load older messages")])):f("",!0),e("div",ze,[(t(!0),o(R,null,j(g.value,b=>{var M;return t(),x(Re,{key:b.id,message:b,"is-own":b.sender_id===((M=m(c).user)==null?void 0:M.id)},null,8,["message","is-own"])}),128))]),e("div",{ref_key:"bottomAnchor",ref:l},null,512)],512),e("div",Fe,[e("div",He,[e("button",{variant:"ghost",onClick:Y,class:"image-upload-button",title:"Send image"},[y(m($),{icon:"tabler:photo-up",class:"w-5 h-5 text-gray-600"})]),G(e("input",{"onUpdate:modelValue":C[0]||(C[0]=b=>_.value=b),type:"text",placeholder:"Type a message...",class:"message-input",onKeydown:X(O,["enter"]),disabled:s.value},null,40,Ne),[[Q,_.value]]),e("button",{onClick:O,disabled:!_.value.trim()||s.value,class:"send-button"},[s.value?(t(),x(m($),{key:1,icon:"svg-spinners:90-ring-with-bg",class:"w-5 h-5 animate-spin text-primary-600"})):(t(),x(m($),{key:0,icon:"tabler:send",class:"w-5 h-5"}))],8,Ye),e("input",{ref_key:"fileInput",ref:h,type:"file",accept:"image/*",onChange:E,class:"hidden"},null,544)]),r.value?(t(),o("div",Ee,[e("div",Ke,[e("img",{src:i.value,alt:"Selected image",class:"preview-image"},null,8,Pe),y(N,{onClick:U,"icon-left":"tabler-x",class:"cancel-image-button"})]),e("button",{onClick:K,disabled:s.value,class:"send-image-button"},[s.value?(t(),o("span",Qe,"Sending...")):(t(),o("span",Ge,"Send Photo"))],8,Je)])):f("",!0)])]))}}),V=D(Xe,[["__scopeId","data-v-713331f3"]]),Ze={class:"chats-container"},es={class:"hidden md:flex h-full"},ss={class:"flex-1 flex flex-col"},ts={key:1,class:"flex-1 flex items-center justify-center text-gray-500"},as={class:"text-center"},os={class:"md:hidden h-full flex flex-col"},ns={key:0,class:"flex-1"},ls={key:1,class:"flex-1 flex flex-col"},rs={class:"bg-white border-b border-gray-200 px-4 py-3 flex items-center"},is={class:"flex items-center"},cs=["src","alt"],ds={key:1,class:"w-8 h-8 rounded-full bg-gray-300 mr-3 flex items-center justify-center"},us={class:"font-medium text-gray-900"},ms={class:"text-sm text-gray-500"},hs=L({__name:"ChatsView",setup(S){const n=ee(),c=se(),a=z(),_=B(),s=w(null),d=T(()=>s.value?a.chats.find(r=>r.id===s.value):null),I=r=>{s.value=r,a.setCurrentChat(r),window.innerWidth>=768?c.replace({name:"chat",params:{id:r}}):c.push({name:"chat",params:{id:r}})},l=()=>{s.value=null,a.setCurrentChat(null),c.push({name:"chats"})};F(()=>n.params.id,r=>{r&&typeof r=="string"?(s.value=r,a.setCurrentChat(r)):n.name==="chats"&&(s.value=null,a.setCurrentChat(null))},{immediate:!0}),H(()=>{a.initialize()});const h=async()=>{var i,g,v;const r={id:"demo-chat",other_user:{id:"demo-user23",full_name:"Ashley Williams"},listing:{id:"demo-listing",title:"Bathroom stuff - towels, shower curtain",description:"Redecorated my bathroom and have extra stuff. 4 bath towels (blue), 2 hand towels, and a shower curtain with hooks. Everything is clean and good quality.",category:"free-stuff",subcategory:"household",location:{lat:0,lng:0}},messages:[]};a.chats.push(r),s.value="demo-chat",(i=a.state.messages)["demo-chat"]??(i["demo-chat"]=[]),a.state.messages["demo-chat"].unshift({id:"msg1",chat_id:"demo-chat",sender_id:"demo-user23",sender_name:"Ashley Williams",message_type:"text",content:"Hi! I saw your listing for towels and stuff. Is it still available?",created_at:new Date("2025-06-30T09:13:43").toISOString()}),a.state.messages["demo-chat"].unshift({id:"msg2",chat_id:"demo-chat",sender_id:((g=_.user)==null?void 0:g.id)??"",sender_name:"You",message_type:"text",content:"Yes, it is! Would you like to pick it up?",created_at:new Date("2025-06-30T09:15:20").toISOString()}),a.state.messages["demo-chat"].unshift({id:"msg1",chat_id:"demo-chat",sender_id:"demo-user23",sender_name:"Ashley Williams",message_type:"text",content:"Yes! I can come by tomorrow afternoon. What time works for you?",created_at:new Date("2025-06-30T09:19:19").toISOString()}),a.state.messages["demo-chat"].unshift({id:"msg2",chat_id:"demo-chat",sender_id:((v=_.user)==null?void 0:v.id)??"",sender_name:"You",message_type:"text",content:"Tomorrow afternoon works great! How about 3pm?",created_at:new Date("2025-06-30T09:24:43").toISOString()}),a.state.messages["demo-chat"].unshift({id:"msg3",chat_id:"demo-chat",sender_id:"demo-user23",sender_name:"Ashley Williams",message_type:"text",content:"Perfect! Iâ€™ll see you then.",created_at:new Date("2025-06-30T09:27:43").toISOString()}),console.log(a.state.messages)};return(r,i)=>{var g,v,p;return t(),o("div",Ze,[e("div",es,[e("div",{class:"w-80 border-r border-gray-200 flex flex-col bg-white",onContextmenu:q(h,["prevent"])},[y(A,{chats:m(a).sortedChats,loading:m(a).loading,"selected-chat-id":s.value,onSelectChat:I},null,8,["chats","loading","selected-chat-id"])],32),e("div",ss,[s.value&&d.value?(t(),x(V,{key:0,chat:d.value,messages:m(a).currentMessages},null,8,["chat","messages"])):(t(),o("div",ts,[e("div",as,[y(m($),{icon:"tabler:message-circle",class:"mx-auto h-12 w-12 text-gray-400 mb-4"}),i[0]||(i[0]=e("p",{class:"text-lg font-medium"},"Select a chat to start messaging",-1)),i[1]||(i[1]=e("p",{class:"text-sm text-gray-400 mt-1"},"Choose from your existing conversations",-1))])]))])]),e("div",os,[s.value?d.value?(t(),o("div",ls,[e("div",rs,[y(N,{variant:"ghost",size:"lg",onClick:l,"icon-left":"tabler:chevron-left",class:"mr-3 p-1 text-2xl text-gray-600 hover:bg-primary-100"}),e("div",is,[(g=d.value.other_user)!=null&&g.avatar_url?(t(),o("img",{key:0,src:d.value.other_user.avatar_url,alt:d.value.other_user.full_name||"User",class:"w-8 h-8 rounded-full mr-3"},null,8,cs)):(t(),o("div",ds,[y(m($),{icon:"tabler:user-filled",class:"h-5 w-5 text-gray-500"})])),e("div",null,[e("h2",us,k(((v=d.value.other_user)==null?void 0:v.full_name)||"Anonymous"),1),e("p",ms,k((p=d.value.listing)==null?void 0:p.title),1)])])]),y(V,{chat:d.value,messages:m(a).currentMessages},null,8,["chat","messages"])])):f("",!0):(t(),o("div",ns,[i[2]||(i[2]=e("div",{class:"bg-white border-b border-gray-200 px-4 py-3"},[e("h1",{class:"text-lg font-semibold text-gray-900"},"Messages")],-1)),y(A,{chats:m(a).sortedChats,loading:m(a).loading,"selected-chat-id":null,onSelectChat:I},null,8,["chats","loading"])]))])])}}}),fs=D(hs,[["__scopeId","data-v-3f6a2787"]]);export{fs as default};
//# sourceMappingURL=ChatsView-Djdh3n1c.js.map
