import{d as q,u as A,k as v,l as M,A as E,e as D,c as i,a as e,t as g,h as d,j as c,I as w,n as W,p as _,q as R,v as j,E as I,B as T,w as z,g as Y,o as l,_ as H,M as G,F as J,C as K,i as O}from"./index-BGnEo6Zc.js";import{u as Q}from"./listings-DVxEMigg.js";import{u as X,_ as Z}from"./ReputationBar.vue_vue_type_script_setup_true_lang-DTXkc58x.js";import{L as ee}from"./Text.vue_vue_type_script_setup_true_lang-CxVtjZvh.js";import{L as te}from"./LocationSelector-B3MsbmQD.js";import{r as se}from"./CheckCircleIcon-C9Y-IBoT.js";import{L as oe}from"./ListingMini-BYir-3sR.js";import"./constants-DDm60LNs.js";import"./Map-aIQ7w-tr.js";const re={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-8"},le={class:"mb-8"},ae={class:"text-2xl font-bold text-gray-900 mb-2"},ie={class:"text-gray-600"},ne={key:0,class:"flex justify-center py-8"},ue={class:"space-y-6"},ce={class:"grid md:grid-cols-2 gap-6"},de={key:0,class:"mt-1 text-sm text-error-600"},me=["value"],fe={key:0,class:"mt-1 text-sm text-error-600"},pe={class:"space-y-6"},ge={key:0,class:"rounded-md bg-error-50 p-4"},ve={class:"flex"},xe={class:"text-sm text-error-700"},ye={key:1,class:"rounded-md bg-success-50 p-4"},_e={class:"flex"},be={class:"text-sm text-success-700"},he={class:"flex justify-end pt-6 border-t border-gray-200"},Pe=q({__name:"UserProfileForm",props:{existingProfile:{default:null},compact:{type:Boolean,default:!1}},emits:["success","error"],setup(V,{expose:k,emit:L}){const a=V,f=L,p=A(),b=v(!1),x=v(!1),m=v(""),y=v(!1),n=v("idle"),o=v(""),r=M({full_name:"",phone:""}),s=M({full_name:"",phone:"",location:null}),h=E(()=>!a.existingProfile),S=E(()=>!!(s.full_name.trim()&&!r.full_name&&!r.phone)),$=()=>{r.full_name="",s.full_name.trim()?s.full_name.trim().length<2&&(r.full_name="Full name must be at least 2 characters"):r.full_name="Full name is required"},F=()=>{r.phone="",s.phone&&s.phone.trim()&&(/^[\+]?[1-9][\d]{0,15}$/.test(s.phone.replace(/[\s\-\(\)]/g,""))||(r.phone="Please enter a valid phone number"))},N=async()=>{n.value="loading",o.value="";try{const u=await ee.getCurrentPosition();s.location={lat:u.latitude,lng:u.longitude},n.value="success"}catch(u){n.value="error",o.value=u.message||"Unable to get your location. Please ensure location services are enabled.",console.error("Location error:",u)}},C=async()=>{if($(),F(),!!S.value){if(!p.session){m.value="Not authenticated";return}x.value=!0,m.value="",y.value=!1;try{const u={full_name:s.full_name.trim(),phone:s.phone.trim()||void 0,location:s.location||void 0};let t;h.value?t=await p.updateProfile(u):t=await p.updateProfile(u),t.error?(m.value=t.error,f("error",t.error)):(y.value=!0,f("success",t.data),setTimeout(()=>{y.value=!1},3e3))}catch(u){const t=u.message||"An error occurred while saving your profile";m.value=t,f("error",t)}finally{x.value=!1}}},U=()=>{a.existingProfile?(s.full_name=a.existingProfile.full_name||"",s.phone=a.existingProfile.phone||"",s.location=a.existingProfile.location||null,s.location&&(n.value="success")):N()};return D(()=>{U()}),k({requestLocation:N,validateForm:()=>($(),F(),S.value),resetForm:U}),(u,t)=>{var B;return l(),i("div",re,[e("div",le,[e("h2",ae,g(h.value?"Welcome! Let's set up your profile":"Edit Your Profile"),1),e("p",ie,g(h.value?"Please provide some basic information to get started with LocalHelp":"Update your profile information and preferences"),1)]),b.value?(l(),i("div",ne,[d(c(w),{icon:"svg-spinners:3-dots-bounce",class:"w-12 h-12 text-secondary-600"}),t[3]||(t[3]=e("p",{class:"mt-4 text-gray-600"},"Loading your profile...",-1))])):(l(),i("form",{key:1,onSubmit:W(C,["prevent"]),class:"space-y-6"},[e("div",ue,[t[8]||(t[8]=e("h3",{class:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2"}," Basic Information ",-1)),e("div",ce,[e("div",null,[t[4]||(t[4]=e("label",{for:"fullName",class:"block text-sm font-medium text-gray-700 mb-2"}," Full Name * ",-1)),R(e("input",{id:"fullName","onUpdate:modelValue":t[0]||(t[0]=P=>s.full_name=P),type:"text",required:"",class:I(["input",{"border-error-300 focus:border-error-500 focus:ring-error-500":r.full_name}]),placeholder:"Enter your full name"},null,2),[[j,s.full_name]]),r.full_name?(l(),i("p",de,g(r.full_name),1)):_("",!0)]),e("div",null,[t[5]||(t[5]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-2"}," Email Address ",-1)),e("input",{id:"email",value:(B=c(p).user)==null?void 0:B.email,type:"email",disabled:"",class:"input bg-gray-50 text-gray-500"},null,8,me),t[6]||(t[6]=e("p",{class:"text-xs text-gray-500 mt-1"},"Email cannot be changed",-1))])]),e("div",null,[t[7]||(t[7]=e("label",{for:"phone",class:"block text-sm font-medium text-gray-700 mb-2"}," Phone Number ",-1)),R(e("input",{id:"phone","onUpdate:modelValue":t[1]||(t[1]=P=>s.phone=P),type:"tel",class:I(["input md:w-1/2",{"border-error-300 focus:border-error-500 focus:ring-error-500":r.phone}]),placeholder:"Enter your phone number (optional)"},null,2),[[j,s.phone]]),r.phone?(l(),i("p",fe,g(r.phone),1)):_("",!0)])]),e("div",pe,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2"},"Location",-1)),d(te,{modelValue:s.location,"onUpdate:modelValue":t[2]||(t[2]=P=>s.location=P),class:"mb-4"},null,8,["modelValue"])]),m.value?(l(),i("div",ge,[e("div",ve,[d(c(w),{icon:"tabler:alert-triangle",class:"w-5 h-5 text-error-400 mr-3 flex-shrink-0"}),e("div",xe,g(m.value),1)])])):_("",!0),y.value?(l(),i("div",ye,[e("div",_e,[d(c(se),{class:"w-5 h-5 text-success-400 mr-3 flex-shrink-0"}),e("div",be,g(h.value?"Profile created successfully!":"Profile updated successfully!"),1)])])):_("",!0),e("div",he,[d(T,{loading:x.value,onClick:C,disabled:x.value||!S.value},{default:z(()=>[Y(g(h.value?"Create Profile":"Update Profile"),1)]),_:1},8,["loading","disabled"])])],32))])}}}),we=H(Pe,[["__scopeId","data-v-3ae1295e"]]),ke={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Le={key:0,class:"mt-8"},Se={class:"card"},Ee={key:1,class:"mt-8"},Ve={class:"card"},$e={class:"flex items-center justify-between mb-6"},Fe={key:0,class:"flex flex-col items-center py-8"},Ne={key:1,class:"text-center py-8"},Ce={class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"},Ue={key:2,class:"space-y-4"},Be=q({__name:"ProfileView",setup(V){const{debug:k,error:L}=G("ProfileView"),a=A(),f=Q(),p=X(),b=v(!1),x=E(()=>a.user?p.getReputationDisplay(a.user.id):{status:"unknown",positive:0,negative:0,total:0,positivePercentage:0,negativePercentage:0,unknownPercentage:100}),m=n=>{k("Profile saved successfully:",n)},y=n=>{n instanceof Error?console.error("Profile error:",n.message):console.error("Profile error:",n)};return D(async()=>{if(a.user){b.value=!0;try{await Promise.all([f.fetchUserListings(a.user.id),p.fetchReputation(a.user.id)])}catch(n){L("Error fetching user data:",n)}finally{b.value=!1}}}),(n,o)=>(l(),i("div",ke,[d(we,{"existing-profile":c(a).user,onSuccess:m,onError:y},null,8,["existing-profile"]),c(a).user?(l(),i("div",Le,[e("div",Se,[o[0]||(o[0]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Your Reputation",-1)),d(Z,{reputation:x.value},null,8,["reputation"])])])):_("",!0),c(a).user?(l(),i("div",Ee,[e("div",Ve,[e("div",$e,[o[2]||(o[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"My Listings",-1)),d(T,{"icon-left":"tabler:plus",link:{name:"create"}},{default:z(()=>o[1]||(o[1]=[Y(" Create Listing ")])),_:1,__:[1]})]),b.value?(l(),i("div",Fe,[d(c(w),{icon:"svg-spinners:3-dots-bounce",class:"w-12 h-12 text-primary-400 mb-4"}),o[3]||(o[3]=e("p",{class:"text-gray-500"},"Loading your listings...",-1))])):c(f).userListings.length===0?(l(),i("div",Ne,[e("div",Ce,[d(c(w),{icon:"tabler:file-broken",class:"w-8 h-8 text-gray-400"})]),o[4]||(o[4]=e("h4",{class:"text-lg font-medium text-gray-900 mb-2"},"No listings yet",-1)),o[5]||(o[5]=e("p",{class:"text-gray-600 mb-4"},"Create your first listing to get started",-1))])):(l(),i("div",Ue,[(l(!0),i(J,null,K(c(f).userListings,r=>(l(),O(oe,{listing:r},null,8,["listing"]))),256))]))])])):_("",!0)]))}}),Ye=H(Be,[["__scopeId","data-v-5b6a495d"]]);export{Ye as default};
//# sourceMappingURL=ProfileView-DlIy1-h-.js.map
